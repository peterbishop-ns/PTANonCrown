<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PTANonCrown.CoarseWoodyMaterialPage"
             xmlns:viewModels="clr-namespace:PTANonCrown.ViewModel"
             xmlns:behav="clr-namespace:PTANonCrown.Behaviours"
             xmlns:converter="clr-namespace:PTANonCrown.Converter"
             BackgroundColor="#F0F0F0"
             Title="Coarse Woody Material">
    <ContentPage.Resources>
        <ResourceDictionary>
            <converter:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid RowDefinitions="Auto,*">
        <VerticalStackLayout Grid.Row="0">
            <Label Text="{Binding ErrorMessage}"
                   Background="Pink"
                   Padding="5"
                   IsVisible="{Binding ErrorMessage, 
Converter={StaticResource StringToVisibilityConverter}}" />
            <Label Text="{Binding CurrentStandAllErrors}"
                   TextColor="Red" />
        </VerticalStackLayout>
        <ScrollView Grid.Row="1">
            <VerticalStackLayout>
            <Border BackgroundColor="LightGoldenrodYellow"
                    StrokeShape="RoundRectangle 2,2,2,2"
                    WidthRequest="200">
                <HorizontalStackLayout HorizontalOptions="Center">
                    <Label Text="Stand"
                           FontAttributes="Bold"
                           Margin="10,0,0,0" />
                    <Label Text="{Binding CurrentStand.StandNumber}"
                           Margin="3,0,0,0" />
                    <Label Text="Plot"
                           FontAttributes="Bold"
                           Margin="10,0,0,0" />
                    <Label Text="{Binding CurrentPlot.PlotNumber}"
                           Margin="3,0,0,0" />
                </HorizontalStackLayout>
            </Border>

            <VerticalStackLayout HorizontalOptions="Start">
                <HorizontalStackLayout>
                    <Label Text="Transect Length (m)"
                           Style="{StaticResource LabelPlot}"
                           WidthRequest="150" />
                    <ImageButton Source="info.png"
                                 HorizontalOptions="Center"
                                 Style="{StaticResource ImageButtonHelper}"
                                 Command="{Binding ShowHelperTextCommand}"
                                 CommandParameter="CWMTransectLength" />
                    <Entry Text="{Binding CurrentPlot.TransectLength}"
                           Keyboard="Numeric"
                           Margin="20,0,0,0"
                           Style="{StaticResource EntryShort}"
                           WidthRequest="50" />
                </HorizontalStackLayout>
                <HorizontalStackLayout>
                    <Label Text="Transect Direction"
                           Style="{StaticResource LabelPlot}"
                           WidthRequest="150" />
                    <ImageButton Source="info.png"
                                 HorizontalOptions="Center"
                                 Style="{StaticResource ImageButtonHelper}"
                                 Command="{Binding ShowHelperTextCommand}"
                                 CommandParameter="CWMTransectDirection" />
                    <Picker WidthRequest="100"
                            Margin="20,0,0,0"
                            ItemsSource="{Binding TransectDirections}"
                            SelectedItem="{Binding CurrentPlot.TransectDirection, Mode=TwoWay}" />
                </HorizontalStackLayout>
            </VerticalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Coarse Woody Material (CWM) Tally"
                       Style="{StaticResource Headline}" />
                <ImageButton Source="info.png"
                             HorizontalOptions="Center"
                             Style="{StaticResource ImageButtonHelper}"
                             Command="{Binding ShowHelperTextCommand}"
                             CommandParameter="CWMGeneral" />
            </HorizontalStackLayout>
            <CollectionView ItemsSource="{Binding CurrentPlot.PlotCoarseWoody}"
                            BackgroundColor="LightGrey"
                            HorizontalOptions="StartAndExpand">
                <!-- Header Row -->
                <CollectionView.Header>
                    <Grid ColumnDefinitions="110,130,130,130,130"
                          RowDefinitions="Auto,Auto"
                          BackgroundColor="DarkGray">
                        <HorizontalStackLayout   Grid.Row="1"
                                                 Grid.Column="0">
                            <Label Text="DBH (cm)"
                                   Style="{StaticResource GridHeader}" />
                            <ImageButton Source="info.png"
                                         HorizontalOptions="Center"
                                         Style="{StaticResource ImageButtonHelper}"
                                         Command="{Binding ShowHelperTextCommand}"
                                         CommandParameter="CWMDBH" />
                        </HorizontalStackLayout>

                        <HorizontalStackLayout Grid.Row="0"
                                               Grid.Column="1"
                                               Grid.ColumnSpan="3"
                                               HorizontalOptions="CenterAndExpand">
                            <Label Text="Species Group"
                                   Style="{StaticResource GridHeader}" />
                            <ImageButton Source="info.png"
                                         HorizontalOptions="Center"
                                         Style="{StaticResource ImageButtonHelper}"
                                         Command="{Binding ShowHelperTextCommand}"
                                         CommandParameter="CWMSpeciesGroup" />
                        </HorizontalStackLayout>

                        <Label Text="Softwood"
                               Style="{StaticResource GridHeader}"
                               Grid.Row="1"
                               Grid.Column="1" />
                        <Label Text="Hardwood"
                               Style="{StaticResource GridHeader}"
                               Grid.Row="1"
                               Grid.Column="2" />
                        <Label Text="Unknown"
                               Style="{StaticResource GridHeader}"
                               Grid.Row="1"
                               Grid.Column="3" />
                        <HorizontalStackLayout  Grid.Row="1"
                                                Grid.Column="4">
                            <Label Text="Cavity"
                                   Style="{StaticResource GridHeader}" />
                            <ImageButton Source="info.png"
                                         HorizontalOptions="Center"
                                         Style="{StaticResource ImageButtonHelper}"
                                         Command="{Binding ShowHelperTextCommand}"
                                         CommandParameter="CWMCavity" />
                        </HorizontalStackLayout>

                    </Grid>
                </CollectionView.Header>

                <!-- Data Rows -->
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="110,130,130,130,130"
                              BackgroundColor="LightGrey">
                            <Label Text="{Binding DBH_range}"
                                   Grid.Column="0" />
                            <HorizontalStackLayout Grid.Column="1">

                                <Entry Text="{Binding Tally_Softwood}"
                                       WidthRequest="10"
                                       TextChanged="OnlyIntegerAllowed"
                                       HorizontalOptions="Start"
                                       Style="{StaticResource GridEntry}">
                                    <Entry.Behaviors>
                                        <behav:EntryFormBehaviour />
                                    </Entry.Behaviors>
                                </Entry>
                                <Stepper Value="{Binding Tally_Softwood}" />
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Grid.Column="2"
                                                   HorizontalOptions="Start">
                                <Entry Text="{Binding Tally_Hardwood}"
                                       WidthRequest="10"
                                       TextChanged="OnlyIntegerAllowed"
                                       Style="{StaticResource GridEntry}">
                                    <Entry.Behaviors>
                                        <behav:EntryFormBehaviour />
                                    </Entry.Behaviors>
                                </Entry>
                                <Stepper Value="{Binding Tally_Hardwood}" />
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Grid.Column="3">
                                <Entry Text="{Binding Tally_Unknown}"
                                       WidthRequest="10"
                                       TextChanged="OnlyIntegerAllowed"
                                       Style="{StaticResource GridEntry}">
                                    <Entry.Behaviors>
                                        <behav:EntryFormBehaviour />
                                    </Entry.Behaviors>
                                </Entry>
                                <Stepper Value="{Binding Tally_Unknown}" />
                            </HorizontalStackLayout>
                            <HorizontalStackLayout Grid.Column="4">

                                <Entry Text="{Binding Tally_Cavity}"
                                       WidthRequest="10"
                                       TextChanged="OnlyIntegerAllowed"
                                       Style="{StaticResource GridEntry}">
                                    <Entry.Behaviors>
                                        <behav:EntryFormBehaviour />
                                    </Entry.Behaviors>
                                </Entry>
                                <Stepper Value="{Binding Tally_Cavity}" />
                            </HorizontalStackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>